2;
function sskcheckMobile(){3;var f=null!=navigator.userAgent.match(/iPad/i);4;if(f)return 5,!1;7;f=null!=navigator.userAgent.match(/iphone|android|phone|mobile|wap|netfront|x11|java|opera mobi|opera mini|ucweb|windows ce|symbian|symbianos|series|webos|sony|blackberry|dopod|nokia|samsung|palmsource|xda|pieplus|meizu|midp|cldc|motorola|foma|docomo|up.browser|up.link|blazer|helio|hosin|huawei|novarra|coolpad|webos|techfaith|palmsource|alcatel|amoi|ktouch|nexian|ericsson|philips|sagem|wellcom|bunjalloo|maui|smartphone|iemobile|spice|bird|zte-|longcos|pantech|gionee|portalmmm|jig browser|hiptop|benq|haier|^lct|320x320|240x320|176x220/i);8;
if(f)return 9,!0;11;return!1}13;14;15;
function sskua(f){16;var d=[];17;d="";18;(d=f.match(/FireFox\/([^\s]+)/ig))?(19,f=d[0].split("/"),20,d='<span class="ua_firefox"><i class="fa fa-globe"></i> Mozilla FireFox|'+f[1],21):(d=f.match(/Maxthon([\d]*)\/([^\s]+)/ig))?(22,d[0].split("/"),23,d='<span class="ua_maxthon"><i class="fa fa-globe"></i> Maxthon',24):(d=f.match(/BIDUBrowser([\d]*)\/([^\s]+)/ig))?(25,f=d[0].split("/"),26,d='<span class="ua_ucweb"><i class="fa fa-globe"></i> \u767e\u5ea6\u6d4f\u89c8\u5668|'+f[1],27):(d=f.match(/UBrowser([\d]*)\/([^\s]+)/ig))?
(28,f=d[0].split("/"),29,d='<span class="ua_ucweb"><i class="fa fa-globe"></i> UCBrowser|'+f[1],30):(d=f.match(/UCBrowser([\d]*)\/([^\s]+)/ig))?(31,f=d[0].split("/"),32,d='<span class="ua_ucweb"><i class="fa fa-globe"></i> UCBrowser|'+f[1],33):f.match(/MetaSr/ig)?(34,d='<span class="ua_sogou"><i class="fa fa-globe"></i> \u641c\u72d7\u6d4f\u89c8\u5668',35):f.match(/2345Explorer/ig)?(36,d='<span class="ua_2345explorer"><a href="http://ssk.91txh.com/2345download.php?id=2" target="_blank" style="color:#FFFFFF!important;"><i class="fa fa-globe"></i> 2345\u738b\u724c\u6d4f\u89c8\u5668</a>',
37):f.match(/2345chrome/ig)?(38,d='<span class="ua_2345chrome"><a href="http://ssk.91txh.com/2345download.php?id=3" target="_blank" style="color:#FFFFFF!important;"><i class="fa fa-globe"></i> 2345\u52a0\u901f\u6d4f\u89c8\u5668</a>',39):f.match(/LBBROWSER/ig)?(40,d='<span class="ua_lbbrowser"><i class="fa fa-globe"></i> \u730e\u8c79\u5b89\u5168\u6d4f\u89c8\u5668',41):(d=f.match(/MicroMessenger\/([^\s]+)/ig))?(42,f=d[0].split("/"),43,d='<span class="ua_qq"><i class="fa fa-weixin"></i> \u5fae\u4fe1|'+
f[1],44):(d=f.match(/QQBrowser\/([^\s]+)/ig))?(45,f=d[0].split("/"),46,d='<span class="ua_qq"><i class="fa fa-globe"></i> QQ\u6d4f\u89c8\u5668|'+f[1],47):(d=f.match(/QQ\/([^\s]+)/ig))?(48,f=d[0].split("/"),49,d='<span class="ua_qq"><i class="fa fa-globe"></i> QQ\u6d4f\u89c8\u5668|'+f[1],50):(d=f.match(/MiuiBrowser\/([^\s]+)/ig))?(51,f=d[0].split("/"),52,d='<span class="ua_mi"><i class="fa fa-globe"></i> Miui\u6d4f\u89c8\u5668|'+f[1],53):(d=f.match(/Edge([\d]*)\/([^\s]+)/ig))?(54,f=d[0].split("/"),
55,d='<span class="ua_ie"><i class="fa fa-globe"></i> Edge|'+f[1],56):(d=f.match(/Chrome([\d]*)\/([^\s]+)/ig))?(57,f=d[0].split("/"),58,d='<span class="ua_chrome"><i class="fa fa-globe"></i> Chrome|'+f[1],59):(d=f.match(/safari\/([^\s]+)/ig))?(60,f=d[0].split("/"),61,d='<span class="ua_apple"><i class="fa fa-globe"></i> Apple Safari|'+f[1],62):(d=f.match(/Opera[\s|\/]([^\s]+)/ig))?(63,d[0].split("/"),64,d='<span class="ua_opera"><i class="fa fa-globe"></i> Opera|'+d[1],65):f.match(/Trident\/7.0/gi)?
(66,d='<span class="ua_ie"><i class="fa fa-globe"></i> Internet Explorer 11',67):(d=f.match(/MSIE\s([^\s|;]+)/gi))?(68,d='<span class="ua_ie"><i class="fa fa-globe"></i> Internet Explorer|'+d[0],69):(70,d='<span class="ua_other"><i class="fa fa-globe"></i> \u5176\u5b83\u6d4f\u89c8\u5668',71);72;sskcheckMobile()?(73,Mobile="<br><br>",74):(75,Mobile="",76);77;return d+"</span>"+Mobile}79;
function sskos(f){80;var d="";81;f.match(/win/ig)?(82,f.match(/nt 5.1/ig)?(83,d='<span class="os_xp"><i class="fa fa-desktop"></i> Windows XP',84):f.match(/nt 6.1/ig)?(85,d='<span class="os_7"><i class="fa fa-desktop"></i> Windows 7',86):f.match(/nt 6.2/ig)?(87,d='<span class="os_8"><i class="fa fa-desktop"></i> Windows 8',88):f.match(/nt 6.3/ig)?(89,d='<span class="os_8_1"><i class="fa fa-desktop"></i> Windows 8.1',90):f.match(/nt 10.0/ig)?(91,d='<span class="os_8_1"><i class="fa fa-desktop"></i> Windows 10',
92):f.match(/nt 6.0/ig)?(93,d='<span class="os_vista"><i class="fa fa-desktop"></i> Windows Vista',94):f.match(/nt 5/ig)?(95,d='<span class="os_2000"><i class="fa fa-desktop"></i> Windows 2000',96):(97,d='<span class="os_windows"><i class="fa fa-desktop"></i> Windows',98),99):f.match(/android/ig)?(100,d='<span class="os_android"><i class="fa fa-android"></i> Android',101):f.match(/ubuntu/ig)?(102,d='<span class="os_ubuntu"><i class="fa fa-desktop"></i> Ubuntu',103):f.match(/linux/ig)?(104,d='<span class="os_linux"><i class="fa fa-linux"></i> Linux',
105):f.match(/mac/ig)?(106,d='<span class="os_mac"><i class="fa fa-desktop"></i> Mac OS X',107):f.match(/unix/ig)?(108,d='<span class="os_unix"><i class="fa fa-desktop"></i> Unix',109):f.match(/symbian/ig)?(110,d='<span class="os_nokia"><i class="fa fa-mobile"></i> Nokia SymbianOS',111):(112,d='<span class="os_other"><i class="fa fa-desktop"></i> \u5176\u5b83\u64cd\u4f5c\u7cfb\u7edf',113);114;return d+"</span>"}116;
!function(f,d,y){function z(){return n.short_name?U+"//"+n.short_name+"."+e.DOMAIN:e.REMOTE}function za(){function b(){for(var b;b=ra.shift();){var l=b.url,d=new a(b.title,{dir:"auto",icon:b.iconUrl,body:b.body});try{d.onclick=function(){f.focus();Q.href=l;d.close()}}catch(e){}setTimeout(function(){d.close&&d.close()},8E3)}}var a=f.Notification;"Notification"in f&&"denied"!==a.permission&&("granted"===a.permission&&b(),a.requestPermission(function(a){"granted"===a&&b()}))}function O(){return 0==u.data.user_id}
function sa(b){e.theme=b;"none"!=b&&p.injectStylesheet(e.STATIC_URL+"/styles/embed"+(b?"."+b+".css?"+Aa[b]:"."+short_name)+".css")}var p={},ta=d.getElementsByTagName("head")[0]||d.getElementsByTagName("body")[0];if(p.extend=function(b,a){for(var c in a)b[c]=a[c];return b},p.injectScript=function(b,a){var c=d.createElement("script"),l=d.head||d.getElementsByTagName("head")[0]||d.documentElement;c.type="text/javascript";c.src=b;c.async="async";c.charset="utf-8";a&&(c.onload=c.onreadystatechange=function(b,
d){(d||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,l&&c.parentNode&&l.removeChild(c),c=y,d||a.call(f))});l.insertBefore(c,l.firstChild)},p.injectStylesheet=function(b){var a=d.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=b;ta.appendChild(a)},p.injectStyle=function(b){var a=d.createElement("style");return a.type="text/css",ta.appendChild(a),b=b.replace(/\}/g,"}\n"),a.styleSheet?a.styleSheet.cssText=b:a.appendChild(d.createTextNode(b)),
a},p.getCookie=function(b){var a,c,l;b=" "+b+"=";for(var e=d.cookie.split(";"),f=0;f<e.length;f++)if(a=" "+e[f],c="a.indexOf(b),0<=c&&c+b.length==(l=a.indexOf("=")+1))return" decodeuricomponent(a.substring(l,a.length).replace(="" \+="" g,""));return="" y},p.param="function(b){var" a="[],c;for(c" in="" b)b[c]!="y&&a.push(c+"="+encodeURIComponent(b[c]));return" a.join("&")},p.cssproperty="function(b,a){var" c="(d.body||d.documentElement).style;if("undefined"==typeof" c)return!1;if("string"="=typeof" c[b])return="" a?b:!0;var="" l="["Moz","Webkit","ms"];b=b.charAt(0).toUpperCase()+b.substr(1);for(var" e="0;e<l.length;e++)if("string"==typeof" c[l[e]+b])return="" a?l[e]+b:!0},!f.duoshuo){for(var="" v="" object.prototype)return="" alert("object.prototype="" \u4e0d\u4e3a\u7a7a\uff0c\u8bf7\u4e0d\u8981\u7ed9="" object.prototype="" \u8bbe\u7f6e\u65b9\u6cd5");var="" n,r,c="f.JSON,Q=f.location,W=f.XMLHttpRequest,B=C&&C.stringify&&f.localStorage,na=f.navigator.userAgent,U="https:"==d.location.protocol?"https:":"http:",X=0,ra=[],v=r=function(){function" b(b){return="" a[b]||="" "&amp;"}var="">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/&(?!\w+;)|[<>"'`]/g,l=/[&<>"'`]/;return function(a){return null==a||!1===a?"":l.test(a)?a.replace(c,b):a}}(),Ba=function(b){if(b.match(/^(http|https):/))return b;var a=d.createElement("a");return a.href=b,G.hrefNormalized?a.href:a.getAttribute("href",4)};V=function(b){return function(){return b}};var J=function(){for(var b={},a=0;a<arguments.length;a++)arguments[a]&&p.extend(b,arguments[a]);return(b=p.param(b))?"?"+b: 10="" 28="" ""},y="function(){var" b="p.getCookie("duoshuo_token");return" b?{jwt:b}:n.remote_auth?{short_name:n.short_name,remote_auth:n.remote_auth}:y},oa="function(){if(!n&&(n=f.duoshuoQuery)){if(!n.short_name||"your_duoshuo_short_name"===n.short_name)return" n="y,void" alert("\u4f60\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u591a\u8bf4\u57df\u540d(duoshuoquery.short_name)\uff0c\u586b\u5165\u5df2\u6709\u57df\u540d\u6216\u521b\u5efa\u65b0\u7ad9\u70b9\uff1ahttp:="" duoshuo.com="" create-site="" ");ua.trigger("querydefined")}return="" n},="" d="function(b){return" b&&b.error&&b.warn?b:{error:function(){},log:function(){},warn:function(){}}}(f.console),e="f.DUOSHUO={sourceName:{weibo:"\u65b0\u6d6a\u5fae\u535a",qq:"QQ",qzone:"QQ\u7a7a\u95f4",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",douban:"\u8c46\u74e3\u7f51",kaixin:"\u5f00\u5fc3\u7f51",sohu:"\u641c\u72d0\u5fae\u535a",baidu:"\u767e\u5ea6",google:"\u8c37\u6b4c",wechat:"\u5fae\u4fe1",weixin:"\u5fae\u4fe1",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"\u5fae\u535a"," qq:"qq",douban:"\u8c46\u74e3",renren:"\u4eba\u4eba",kaixin:"\u5f00\u5fc3",baidu:"\u767e\u5ea6",google:"\u8c37\u6b4c",wechat:"\u5fae\u4fe1",weixin:"\u5fae\u4fe1",facebook:"facebook",twitter:"twitter",linkedin:"linkedin"},parsedate:function(b){return="" b.parse("2011-10-28t00:00:00+08:00")&&function(a){return="" new="" b(a)}||b.parse("2011="" 28t00:00:00+0800")&&function(a){return="" b(a.replace(="" -="" g,"="" ").replace(="" :(\d\d)$="" ,"$1"))}||b.parse("2011="" 00:00:00+0800")&&function(a){return="" g,="" "="" ,"$1").replace("t","="" "))}||function(a){return="" b(a)}}(date),fulltime:function(b){b="e.parseDate(b);return" b.getfullyear()+"\u5e74"+(b.getmonth()+1)+"\u6708"+b.getdate()+"\u65e5="" "+b.tolocaletimestring()},elapsedtime:function(b){b="e.parseDate(b);var" a="new" date,c="(a-X-b)/1E3;return">c?"\u521a\u521a":60>c?Math.round(c)+"\u79d2\u524d":3600>c?Math.round(c/60)+"\u5206\u949f\u524d":86400>c?Math.round(c/3600)+"\u5c0f\u65f6\u524d":(a.getFullYear()==b.getFullYear()?"":b.getFullYear()+
"\u5e74")+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5"},compileStyle:function(b){var a="",c={};if(c.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!b)return a;for(var l in b)a+=c[l]+"{"+b[l]+"}\n";return a},init:function(b,a){b&&!ca[b]&&(ca[b]=a||{type:"EmbedThread"});e.initView&&e.initView()}},Ca=d.all,G=e.support=function(){var b=d.createElement("div");b.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox">';var a=b.getElementsByTagName("a")[0],a={placeholder:"placeholder"in
b.getElementsByTagName("input")[0],touch:"ontouchstart"in f||"onmsgesturechange"in f,opacity:/^0.55$/.test(a.style.opacity),hrefNormalized:"/a"===a.getAttribute("href"),iOS:na.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:na.match(/ \(Linux; U; Android /)};return a.ie6=!W&&"undefined"==typeof b.style.maxHeight,a.authInWin=f.postMessage&&800<f.screen.width&&!a.ios&&!a.android&&q.origin,a}(),ca=e.selectors={".ds-thread":{type:"embedthread"},".ds-recent-comments":{type:"recentcomments"}, ".ds-recent-visitors":{type:"recentvisitors"},".ds-top-users":{type:"topusers"},".ds-top-threads":{type:"topthreads"},".ds-login":{type:"loginwidget"},".ds-thread-count":{type:"threadcount"},".ds-share":{type:"sharewidget"}},r="e.openDialog=function(b){return" e.dialog!="=y&&e.dialog.el.remove(),e.dialog=(new" m.dialog(g.dialog(b))).open()},va="e.smilies={};e.require=function(){function" b(a){return="" e.static_url+"="" libs="" "+a+".js"+(wa[a]?"?"+wa[a]+".js":"")}var="" a="{mzadxN:"undefined"!=typeof" mzadxn};return"undefined"!="typeof" jquery&&"1.5"<="jQuery.fn.jquery&&(a["embed.compat"]=!0,e.jQuery=f.jQuery),function(c,l){if("string"==typeof" c)a[c]?l():p.injectscript(b(c),function(){a[c]="!0;l()});else" if("object"="=typeof" c){var="" d,e="!0;for(d=0;d<c.length;d++)(function(f){a[c[d]]||(e=!1,p.injectScript(b(f),function(){a[f]=!0;for(var" b="0;b<c.length;b++)if(!a[c[b]])return;l()}))})(c[d]);e&&l()}}}();for(var" t="0,w="EmbedThread" recentcomments="" recentvisitors="" topusers="" topthreads="" loginwidget="" threadcount".split("="" ");t<w.length;t++)e[w[t]]="function(b){return" function(a,c){c="c||{};c.type=b;a&&!ca[a]&&(ca[a]=c);e.initSelector&&e.initSelector(a,c)}}(w[t]),e["create"+w[t]]=function(b){return" function(a,c){var="" l="d.createElement(a),f;for(f" in="" c)l.setattribute("data-"+f,c[f]);return="" e[b](l),l}}(w[t]);e.recentcommentswidget="e.RecentComments;var" f(a,b,c){var="" e,g;if(200<="a&&300">a||304===a)if(304===a)b="notmodified",g=!0;else try{e=C.parse(c),b="success",g=!0}catch(m){b="parsererror"}else{b&&!a||(b="error");
try{e=C.parse(c)}catch(m){b="parsererror"}}g?l&&l(e):"parseerror"===b?D.error("\u89e3\u6790\u9519\u8bef: "+c):(D.error("\u51fa\u9519\u5566("+e.code+"): "+e.errorMessage),d&&d(e),e.errorTrace&&D.error(e.errorTrace));(a=k.getResponseHeader("Date"))&&(X=new Date-new Date(a))}var g=p.getCookie("duoshuo_token");c=c||{};c.v=e.version;g?c.jwt=g:n.remote_auth&&(c.remote_auth=n.remote_auth);if(W&&C&&C.parse){var k=new W;if(k&&"withCredentials"in k){var m;return k.open(b,z()+"/api/"+a+".json"+("GET"==b?"?"+
p.param(c):""),!0),k.withCredentials=!0,k.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),k.send("GET"==b?null:p.param(c)),m=function(a,b){var c,l,d,e;try{if(m&&(b||4===k.readyState))if(m=y,b)4!==k.readyState&&k.abort();else{c=k.status;d=k.getAllResponseHeaders();try{e=k.responseText}catch(g){}try{l=k.statusText}catch(g){l=""}}}catch(g){b||f(-1,g)}e&&f(c,l,e,d)},void(4===k.readyState?m():k.onreadystatechange=m)}}"GET"!=b&&(c._method="POST");b="cb_"+Math.round(1E6*
Math.random());A[b]=function(a){switch(a.code){case 0:l&&l(a);break;default:d&&d(a),D.error("\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage),a.errorTrace&&D.error(a.errorTrace)}};c.callback="DUOSHUO.API['"+b+"']";p.injectScript(z()+"/api/"+a+".jsonp?"+p.param(c))},get:function(b,a,c,l){return this.ajax("GET",b,a,c,l)},post:function(b,a,c,l){return this.ajax("POST",b,a,c,l)}},xa=e.ws={messages:[],send:function(b){if(!("WebSocket"in f&&C))return!1;var a=this;if(a.messages.push(C.stringify(b)),!a.webSocket){var c=
a.webSocket=new WebSocket("https:"===d.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/");c.onopen=function(){var b;if(1===c.readyState)for(;b=a.messages.shift();)c.send(b)};c.onmessage=function(a){try{var b=C.parse(a.data)}catch(c){return}switch(b.type){case "post":for(var d=0;d<e.pagelets.length;d++)a=e.pagelets[d],a.threadid==b.thread_id&&a.onmessage(b);break;case "notification":ra.push(b),za()}};f.addeventlistener("beforeunload",function(){c.close()})}a.websocket.onopen()}};="" e.domain="duoshuo.com" ;e.static_url="U+"//static.duoshuo.com";e.REMOTE=U+"//duoshuo.com";e.version="15.11.15";var" aa="{"default":"79dc948b",dark:"ddc346d8",bluebox:"0f0f035c",newhua:"dc453ca2"},wa={"embed.compat":"24f8ca3f",smilies:"921e8eda"},k={post:"\u53d1\u5e03",posting:"\u6b63\u5728\u53d1\u5e03",settings:"\u8bbe\u7f6e",reply:"\u56de\u590d",like:"\u9876",repost:"\u8f6c\u53d1",report:"\u4e3e\u62a5","delete":"\u5220\u9664",reply_to:"\u56de\u590d" ",reposts:"\u8f6c\u53d1",comments:"\u8bc4\u8bba",floor:"\u697c",="" latest:"\u6700\u65b0",earliest:"\u6700\u65e9",hottest:"\u6700\u70ed",share_to:"\u5206\u4eab\u5230:",leave_a_message:"\u8bf4\u70b9\u4ec0\u4e48\u5427\u2026",no_comments_yet:"\u8fd8\u6ca1\u6709\u8bc4\u8bba\uff0c\u6c99\u53d1\u7b49\u4f60\u6765\u62a2",repost_reason:"\u8bf7\u8f93\u5165\u8f6c\u53d1\u7406\u7531",hot_posts_title:"\u88ab\u9876\u8d77\u6765\u7684\u8bc4\u8bba",comments_zero:"\u6682\u65e0\u8bc4\u8bba",comments_one:"1\u6761\u8bc4\u8bba",comments_multiple:"{num}\u6761\u8bc4\u8bba",reposts_zero:"\u6682\u65e0\u8f6c\u53d1",="" reposts_one:"1\u6761\u8f6c\u53d1",reposts_multiple:"{num}\u6761\u8f6c\u53d1",weibo_reposts_zero:"\u6682\u65e0\u65b0\u6d6a\u5fae\u535a",weibo_reposts_one:"1\u6761\u65b0\u6d6a\u5fae\u535a",weibo_reposts_multiple:"{num}\u6761\u65b0\u6d6a\u5fae\u535a",qqt_reposts_zero:"\u6682\u65e0\u817e\u8baf\u5fae\u535a",qqt_reposts_one:"1\u6761\u817e\u8baf\u5fae\u535a",qqt_reposts_multiple:"{num}\u6761\u817e\u8baf\u5fae\u535a"},ga="{get:function(b){return" b?b[b]:void="" 0},save:function(b,a){if(b)try{b.removeitem(b),b[b]="C.stringify(a),B.removeItem(b+":timestamp"),B[b+":timestamp"]=Math.floor((new" date-x)="" 1e3)}catch(c){}}},ha="e.loadRequire=function(b){if(b.visitor&&(!u.data&&b.visitor.user_id&&f.Notification&&xa.send({logged_user_id:b.visitor.user_id}),u.reset(b.visitor)),b.site&&(S.reset(b.site),ga.save("ds_site_"+n.short_name,b.site)),!e.theme&&S.data.theme&&sa(S.data.theme),b.lang&&(p.extend(k,b.lang),ga.save("ds_lang_"+n.short_name,b.lang)),b.stylesheets)for(var" a="0;a<b.stylesheets.length;a++)p.injectStylesheet(b.stylesheets[a]);" if(b.nonce&&(e.nonce="b.nonce),b.style&&p.injectStyle((b.style||"")+e.compileStyle(n.component_style)),b.unread&&K.reset(b.unread),b.warnings)for(a=0;a<b.warnings.length;a++)D.warn(b.warnings[a])},T=0,t=e.Class=function(){};t.extend=function(b){function" a(){!t&&this.init&&this.init.apply(this,arguments)}t="1;var" c="new" this;t="0;for(var" d="" in="" b)c[d]="b[d];return" a.prototype="c,a.prototype.constructor=a,a.extend=arguments.callee,a};var" ia="e.Event=t.extend({on:function(b,a){var" {});return="" c[b]="==y&&(c[b]=[]),c[b].push(a),this},trigger:function(b,a){var" this}}),h="e.Widget=ia.extend({init:function(b,a){this.el=b;this.options=a||{};this.render()},render:function(){},reset:function(){},load:function(b){switch(b.code){case" 0:ha(b);var="" prepare:function(b){return="" b},onmessage:function(){},onerror:function(b){d.error("\u51fa\u9519\u5566("+b.code+"):="" "+b.errormessage);b.errortrace&&d.error(b.errortrace)}}),t="e.Model=ia.extend({init:function(b){this.data=b},reset:function(b){this.data=b;this.trigger("reset")},remove:function(b){this.data.splice(b,1);this.trigger("reset")},set:function(b,a){if(a===y)for(var" b)this.data[c]="b[c];else" this.data[b]="a;return" this.trigger("reset"),this},tojson:function(){return="" p.extend({},this.data)}}),="" pa="t.extend({toJSON:function(){return" p.extend({},this.data)}}),ja="t.extend({toJSON:function(){var" b="p.extend({},this.data);return" b.theauthor="L[this.data.author_id]&&L[this.data.author_id].data||this.data.author,b.parents=this.data.parents||[],b}}),qa=t.extend({toJSON:function(){return" p.extend({},this.data)}}),w="function(b){this.model=b};w.prototype.set=function(b){for(var" b)b[a]&&(this[a]?this[a].set(b[a]):this[a]="new" this.model(b[a]))};w.prototype.get="function(b){for(var" this[b[a]];return="" c};w.prototype.getjson="function(b){for(var" c};var="" e="{userUrl:function(b){return" b.url},avatarurl:function(b){return="" b.avatar_url||s.data.default_avatar_url},loginurl:function(b,a){return="" a||(a="{}),n.sso&&n.sso.login&&(a.sso=1,a.redirect_uri=n.sso.login),z()+"/login/"+b+"/"+J(a)},bindUrl:function(b){return" z()+"="" bind="" "+b+"="" "+j(n.sso&&n.sso.login?{sso:1,redirect_uri:n.sso.login}:null,y())},logouturl:function(){return="" z()+="" "="" logout="" "+j(n.sso&&n.sso.logout?{sso:1,redirect_uri:n.sso.logout}:null)}},z="["weixin","weibo","qq","renren"],aa=["douban","kaixin","baidu","google"],g=e.templates={userAnchor:function(b){return" b.url?'<a="" rel="nofollow author" target="_blank" href="'+v(b.url)+'">'+v(b.name)+"":v(b.name)},avatarImg:function(b,a){return'<img src="'+v(E.avatarUrl(b,a))+'" alt="'+v(b.name)+'" '+(a?'="" style="width:'+a+" px;height:"+a+'px"':"")+"="">"},avatar:function(b,a){var c=g.avatarImg(b,a),d=E.userUrl(b);return d?
'<a rel="nofollow author" target="_blank" href="'+v(d)+'" '+(b.user_id?"="" onclick="\"this.href='"+z()+"/user-url/?user_id="+b.user_id+"';\"":"")+'" title="'+v(b.name)+'">'+c+"</a>":c},timeText:function(b){return b?'<span class="ds-time" datetime="'+b+'" title="'+e.fullTime(b)+'">'+e.elapsedTime(b)+"</span>":""},timeAnchor:function(b,a){return b?'<a href="'+a+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+b+'" title="'+e.fullTime(b)+'">'+e.elapsedTime(b)+"</a>":""},serviceIcon:function(b,
a){return'<a href="javascript:void(0)" class="ds-service-icon'+(a?" -grey":"")+"="" ds-"+b+'"="" data-service="'+b+'" title="'+e.sourceName[b]+'" target="_blank" rel="external"></a>'},poweredBy:function(b){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+v(b)+"</a></p>"},indicator:V('<div id="ds-indicator"></div>'),waitingImg:V('<div id="ds-waiting"></div>'),loginItem:function(b,a){return'<li>    <a href="'+E[a?" bindurl":"loginurl"](b)+'"="" rel="nofollow" class="ds-service-link ds-'+b+'">'+e.serviceNames[b]+
(u.data.social_uid[b]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},ba=function(b){var a=[],c;for(c in b)a.push('<input type="hidden" name="'+c+'" value="'+v(b[c])+'">');return a.join("\n")};g.commentList=function(b){var a="",c=b.list;if(c)for(var d,e=-1,f=c.length-1;f>e;)d=c[e+=1],a+='<li class="ds-comment',b.options.show_avatars&&(a+=" ds-show-avatars"),a+="" data-post-id="" +d.post_id+'"="">',b.options.show_avatars&&(a+='<div class="ds-avatar">'+g.avatar(d.theAuthor,b.options.avatar_size)+
"</div>"),a+='<div class="ds-meta">'+g.userAnchor(d.theAuthor),b.options.show_time&&(a+=g.timeText(d.created_at)),a+="</div>",a+=b.options.show_title?'<div class="ds-thread-title">\u5728 <a href="'+r(d.thread.url)+'#comments">'+r(d.thread.title)+'</a> \u4e2d\u8bc4\u8bba</div><div class="ds-excerpt">'+d.message+"</div>":'<a class="ds-excerpt" title="'+d.thread.title+' \u4e2d\u7684\u8bc4\u8bba" href="'+r(d.thread.url)+'#comments">'+d.message+"</a>",a+="</li>";return a};g.ctxPost=function(b){var a="";
return b.post&&(a+='<li class="ds-ctx-entry" ',b.hidden&&(a+=" style="display:none"" ),a+=" data-post-id="" +b.post.post_id+'"=""><div class="ds-avatar">'+g.avatar(b.post.theAuthor||b.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+g.userAnchor(b.post.theAuthor||b.post.author)+g.timeAnchor(b.post.created_at,b.post.url),0<=b.index&&(a+='<div class="ds-ctx-nth" title="'+e.fullTime(b.post.created_at)+'">'+(b.index+1)+k.floor+"</=b.index&&(a+='<div></div>"),a+='</div><div class="ds-ctx-content">'+b.post.message,
0<=b.index&&(a+='\u3000\u3000\u3000\u3000\u3000\u3000\u3000<div class="ds-comment-actions',0<b.post.vote&&(a+=" ds-post-liked"),a+="">" +g.likepost(b.post)+'<a="" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+k.repost+'<a class="ds-post-reply" href="javascript:void(0);" target="_blank" rel="external"><span class="ds-icon ds-icon-reply"></span>'+k.reply+"</a></=b.index&&(a+='\u3000\u3000\u3000\u3000\u3000\u3000\u3000<div></div>"),a+="</li>"),a};g["dialog-anonymous"]=function(b){var a='<h2>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2><div class="ds-icons-32">',
c=b.services;if(c)for(var d,f=-1,g=c.length-1;g>f;)d=c[f+=1],a+='<a class="ds-'+d+'" href="'+E.loginUrl(d)+'">'+e.sourceName[d]+"</a>";return a+="</div>",b.options.deny_anonymous||(a+='<h2>\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+r(u.data.name)+'" required><label for="ds-dialog-name">\u540d\u5b57(\u5fc5\u586b)</label></div>',b.options.require_guest_email&&(a+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+
r(u.data.email)+'" required><label for="ds-dialog-email">\u90ae\u7bb1(\u5fc5\u586b)</label></div>'),b.options.require_guest_url&&(a+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+r(u.data.url)+'"><label for="ds-dialog-url">\u7f51\u5740(\u53ef\u9009)</label></div>'),a+='<button type="submit">\u53d1\u5e03</button></form>'),a};g["dialog-ask-for-auth"]=function(){return'<h2>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2><ul class="ds-service-list">'+
g.serviceList(Z)+'</ul><ul class="ds-service-list ds-additional-services">'+g.serviceList(aa)+"</ul>"};g["dialog-bind-more"]=function(){return'<h2>\u7ed1\u5b9a\u66f4\u591a\u5e10\u53f7</h2><ul class="ds-service-list">'+g.serviceBindList(Z)+'</ul><ul class="ds-service-list ds-additional-services">'+g.serviceBindList(aa)+'</ul><div style="clear:both"></div>'};g["dialog-qrcode"]=function(b){return'<h2>\u5fae\u4fe1\u626b\u4e00\u626b\uff0c\u5206\u4eab\u5230\u670b\u53cb\u5708</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+
b.qrcode_url+'" alt="'+b.url+'"></div>'};g["dialog-reposts"]=function(b){var a='<h2>\u8f6c\u53d1\u5230\u5fae\u535a</h2><div class="ds-quote"><strong>@'+r(b.post.theAuthor.name)+"</strong>: "+b.post.message+"</div><form>"+ba({post_id:b.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="'+r(k.repost_reason)+'">'+r(b.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return a+='</div><div class="ds-actions">',
b.service?a+=ba({"service[]":b.service}):(a+='<label><input type="checkbox" name="service[]" value="weibo" ',u.data.social_uid.weibo&&(a+=" checked="checked"" ),a+=" /><span class="ds-service-icon ds-weibo"></span>\u65b0\u6d6a\u5fae\u535a</label><label><input type="checkbox" name="service[]" value="qqt"" ,u.data.social_uid.qq&&(a+=" checked="checked"" ),a+('<button="">'+k.repost+"</label></div></form>")};
g.dialog=function(b){return'<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+b+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed" target="_blank" rel="external"></a></div></div>'};g.hotPosts=function(b){var a='<div class="ds-header ds-gradient-bg">'+r(k.hot_posts_title)+"</div><ul>",c=b.list;if(c)for(var d,
e=-1,f=c.length-1;f>e;)d=c[e+=1],a+=g.post({post:d,options:b.options});return a+"</ul>"};g.likePost=function(b){var a='<a class="ds-post-likes" href="javascript:void(0);" target="_blank" rel="external"><span class="ds-icon ds-icon-like"></span>'+k.like;return 0<b.likes&&(a+="("+b.likes+")"),a+"< a="">"};g.likeTooltip=function(b){var a='<div class="ds-like-tooltip ds-rounded"><p>\u5f88\u9ad8\u5174\u4f60\u80fd\u559c\u6b22\uff0c\u5206\u4eab\u4e00\u4e0b\u5427\uff1a</p><ul>',c;for(c in b.services)a+='<li><a class="ds-share-to-'+c+" ds-service-link="" ds-"+="" c+'"="" href="'+z()+" share-proxy="" ?"+p.param({service:c,thread_id:b.thread_id})+'"="">'+b.services[c]+"</a></li>";return a+'</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">\u7b97\u4e86</a></p></div>'};g.loginButtons=function(){return'<div class="ds-login-buttons"><p>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55:</p><div class="ds-social-links"><ul class="ds-service-list">'+g.serviceList(Z)+'<li><a class="ds-more-services" href="javascript:void(0)" target="_blank" rel="external">\u66f4\u591a\u00bb</a></li></ul><ul class="ds-service-list ds-additional-services">'+
g.serviceList(aa)+"</ul></div></div>"};g.loginWidget=function(b){var a='<div class="ds-icons-32">';if(b)for(var c,d=-1,f=b.length-1;f>d;)c=b[d+=1],a+='<a class="ds-'+c+'" href="'+E.loginUrl(c)+'">'+e.sourceName[c]+"</a>";return a+"</div>"};g.meta=function(b){var a='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return 0<b.user_vote&&(a+=" ds-thread-liked"),a+=""><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">" ,a+="0<b.user_vote?" "\u5df2\u559c\u6b22":"\u559c\u6b22",a+'<="" span="" target="_blank" rel="external"><span class="ds-thread-cancel-like">\u53d6\u6d88\u559c\u6b22</span></a><span class="ds-like-panel"></span></div>'};g.notify=function(b){var a='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="\u591a\u8bf4"></a><ul class="ds-notify-unread"><li';return b.comments||(a+=" style="display:none;"" ),a+="><a data-type="unread-comments" href="javascript:void(0);">\u4f60\u6709" +b.comments+"\u6761\u65b0\u56de\u590d<="" a=""><li", b.notifications||(a+=" style="display:none;"" ),a+('=""><a data-type="unread-notifications" href="javascript:void(0);" target="_blank" rel="external">\u4f60\u6709'+b.notifications+"\u6761\u7cfb\u7edf\u6d88\u606f</a></li",></li';return></ul></div>")};g.post=function(b){var a="",c=b.post;b=b.options;var d=c.author;if(a+='<li class="ds-post" data-post-id="'+c.post_id+'"><div class="ds-post-self" data-post-id="'+c.post_id+'" data-thread-id="'+c.thread_id+'" data-root-id="'+c.root_id+'" data-source="'+c.source+'"><div class="ds-avatar" ',d.user_id&&(a+=" data-user-id="" +d.user_id+'"'),a+=">" +g.avatar(d),e.sourcename[c.source]&&(a+="g.serviceIcon(c.source)),a+='</div"><div class="ds-comment-body"><div class="ds-comment-header">',d.url?(a+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(d.qqt_account||" ")+'"="" href="'+r(d.url)+'" ',d.user_id&&(a+=" onclick=\" this.href=""+z()+"/user-url/?user_id="+d.user_id+"" ;\""),a+=" rel="nofollow" target="_blank"" ,d.user_id&&(a+=" data-user-id="" +d.user_id+'"'),a+=">" +r(d.name)+"<="" a="">"):(a+='<span class="ds-user-name" ',="" d.user_id&&(a+=" data-user-id="" +d.user_id+'"'),a+=" data-qqt-account="" +(d.qqt_account||"")+'"="">'+r(d.name)+"</span>"),a+='<span class="ua">'+sskua(c.agent)+'</span><span class="ua">'+sskos(c.agent)+"</span>",a+="</a></div>",1==b.max_depth&&b.show_context&&c.parents.length){var a=a+'<ol id="ds-ctx">',f=I.getJSON(c.parents);if(f)for(var m,d=-1,n=f.length-1;n>d;)m=f[d+=1],1==d&&2<c.parents.length&&(a+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand" target="_blank" rel="external">\u8fd8\u6709'+(c.parents.length-
2)+"\u6761\u8bc4\u8bba</a></c.parents.length&&(a+='<li></ol></div></div></div></li>"),a+=g.ctxPost({post:m,index:d,hidden:d&&d<c.parents.length-1});a+="< ol="">"}if(a+="<p>",c.parents.length>=b.max_depth&&(!b.show_context||1<b.max_depth)&&c.parent_id&&i[c.parent_id]&&(a+='<a class="ds-comment-context" data-post-id="'+c.post_id+'" data-parent-id="'+c.parent_id+'">'+k.reply_to+r(I[c.parent_id].toJSON().author.name)+": </b.max_depth)&&c.parent_id&&i[c.parent_id]&&(a+='<a></p></c.parents.length-1});a+="<></b.likes&&(a+="("+b.likes+")"),a+"<></a>"),a+=c.message+'<p></p><div class="ds-comment-footer ds-comment-actions',0<c.vote&&(a+=" ds-post-liked"),a+="">" ,a+="c.url?g.timeAnchor(c.created_at," c.url):g.timetext(c.created_at),"duoshuo"="=c.source?(a+='<a" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+k.reply+""+g.likePost(c)+'<a class="ds-post-repost" href="javascript:void(0);" target="_blank" rel="external"><span class="ds-icon ds-icon-share"></span>'+k.repost+'</a><a class="ds-post-report" href="javascript:void(0);" target="_blank" rel="external"><span class="ds-icon ds-icon-report"></span>'+k.report+"</a>",c.privileges["delete"]&&(a+='<a class="ds-post-delete" href="javascript:void(0);" target="_blank" rel="external"><span class="ds-icon ds-icon-delete"></span>'+
k["delete"]+"</a>")):("qqt"==c.source||"weibo"==c.source)&&(a+='<a class="ds-weibo-comments" href="javascript:void(0);" target="_blank" rel="external">'+k.comments,c.type.match(/\-comment$/)||(a+='(<span class="ds-count">'+c.comments+"</span>)"),a+='</a><a class="ds-weibo-reposts" href="javascript:void(0);" target="_blank" rel="external">'+k.reposts,c.type.match(/\-comment$/)||(a+='(<span class="ds-count">'+c.reposts+"</span>)"),a+="</a>"),a+="</div>",1<b.max_depth&&(c.childrenarray||c.children)&&"weibo"!=c.source&&"qqt"!=c.source){a+='<ul class="ds-children">';
if(f=I.getJSON(c.childrenArray||c.children))for(d=-1,m=f.length-1;m>d;)c=f[d+=1],a+=g.post({post:c,options:b});a+=""}return a+""};g.postListHead=function(b){var a='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+k.latest+'</a><a class="ds-order-asc">'+k.earliest+'</a><a class="ds-order-hot">'+k.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);" target="_blank" rel="external"></a></li>';return b.options.show_reposts&&
b.thread.reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);" target="_blank" rel="external"></a></li>'),a+=" ",b.options.show_weibo&&b.thread.weibo_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);" target="_blank" rel="external"></a></li>'),a+=" ",b.options.show_qqt&&b.thread.qqt_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);" target="_blank" rel="external"></a></li>'),a+"</ul></div>"};g.recentVisitors=function(b){var a="",c=b.response;if(c)for(var d,e=-1,f=c.length-
1;f>e;)d=c[e+=1],a+='<div class="ds-avatar">'+g.avatar(d,b.options.avatar_size)+"</div>";return a};g.replybox=function(b){var a='<div class="ds-replybox"><a class="ds-avatar" ';if(a+="O()?'" href="javascript:void(0);" onclick="return false" ':'="" settings="" avatar="" "+j(y())+'"="" target="_blank" title="\u8bbe\u7f6e\u5934\u50cf" ',a+=">" +g.avatarimg(u.data)+'<="" a=""><form method="post">'+ba(b.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="'+
r(k.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',a+="</div>",a+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!O()&&u.data.repostOptions){a+='<input id="ds-sync-checkbox';b.inline&&(a+=" -inline");a+="" type="checkbox" name="repost" " ;b.checked&&(a+="checked="checked" " );a+="value="" +b.repostarray.join(",")+'"=""> <label for="ds-sync-checkbox';b.inline&&(a+=" -inline");var="" a="a+('"">'+k.share_to+"</label>"),c;for(c in u.data.repostOptions)a+=
g.serviceIcon(c,!u.data.repostOptions[c])}return a+="</span>",a+="</div>",a+='<button class="ds-post-button" type="submit">'+r(k.post)+'</button><div class="ds-toolbar-buttons">',b.options.use_smilies&&(a+='<a class="ds-toolbar-button ds-add-emote" title="\u63d2\u5165\u8868\u60c5"></a>'),b.options.use_images&&b.options.parse_html_enabled&&(a+='<a class="ds-toolbar-button ds-add-image" title="\u63d2\u5165\u56fe\u7247"></a>'),a+="</div></div>",a+"</form></a></div>"};g.serviceBindList=function(b){var a=
"";if(b)for(var c,d=-1,f=b.length-1;f>d;)c=b[d+=1],a+='<li><a href="'+E.bindUrl(c)+'" rel="nofollow" class="ds-service-link ds-'+c+'">'+e.serviceNames[c],u.data.social_uid[c]&&(a+=' <span class="ds-icon ds-icon-ok"></span>'),a+="</a></li>";return a};g.serviceList=function(b){var a="";if(b)for(var c,d=-1,f=b.length-1;f>d;)c=b[d+=1],a+='<li><a href="'+E.loginUrl(c)+'" rel="nofollow" class="ds-service-link ds-'+c+'">'+e.serviceNames[c]+"</a></li>";return a};g.shareWidget=function(b){var a='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',
c=b.services;if(c)for(var d,f=-1,g=c.length-1;g>f;)d=c[f+=1],a+=' <li> <a class="ds-'+d+'" href="javascript:void(0);" data-service="'+d+'" target="_blank" rel="external">'+e.sourceName[d]+"</a> </li> ";return a+(' </ul> </div> <div class="ds-share-icons-footer">'+b.copyright+"</div></div>")};g.smiliesTooltip=function(b){var a='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">',c;for(c in b)a+="<li><a>"+c+"</a></li>";return a+'</ul><div class="ds-smilies-container"></div></div>'};g.toolbar=function(){var b='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>\u5e10\u53f7\u7ba1\u7406</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none" target="_blank" rel="external">\u7ed1\u5b9a\u66f4\u591a</a></li><li><a target="_blank" href="'+
e.REMOTE+" settings="" "+j(y())+'"="">'+r(k.settings)+'</a></li><li><a rel="nofollow" href="'+E.logoutUrl()+'" style="border-bottom: none">\u767b\u51fa</a></li></ul></div><div class="ds-visitor">';return b+=u.data.url?'<a class="ds-visitor-name" href="'+r(u.data.url)+'" target="_blank">'+r(u.data.name)+"</a>":'<span class="ds-visitor-name">'+r(u.data.name)+"</span>",b+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="\u65b0\u56de\u590d" target="_blank" rel="external"></a></div></div>'};g.topThreads=function(b){var a=
"";if(b=b.response)for(var c,d=-1,e=b.length-1;e>d;)c=b[d+=1],a+='<li><a target="_blank" href="'+r(c.url)+'" title="'+r(c.title)+'">'+r(c.title)+"</a></li>";return a};g.topUsers=function(b){var a="",c=b.response;if(c)for(var d,e=-1,f=c.length-1;f>e;)d=c[e+=1],a+='<div class="ds-avatar">'+g.avatar(d,b.options.avatar_size)+"<h4>"+r(d.name)+"</h4></div>";return a};g.userInfo=function(b){var a='<a href="'+r(b.url)+'" onclick="this.href=\''+z()+" user-url="" ?user_id="+b.user_id+'\';" class="ds-avatar" target="_blank">'+
g.avatarImg(b)+'</a><a href="'+r(b.url)+'" onclick="this.href=\''+z()+" user-url="" ?user_id="+b.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+r(b.name)+"</a>",c;for(c in b.social_uid)a+='<a href="'+e.REMOTE+" user-proxy="" "+c+"="" "+b.social_uid[c]+'="" "="" target="_blank" class="ds-service-icon ds-'+c+'" title="'+e.sourceName[c]+'"></a>';return a+='<p class="ds-user-card-meta"><a href="'+e.REMOTE+" profile="" "+b.user_id+'="" "="" target="_blank"><span class="ds-highlight">'+b.comments+"</span>\u6761\u8bc4\u8bba</a></p>",
b.description&&(a+='<p class="ds-user-description">'+r(b.description)+"</p>"),a};var m=e.Views={},Da=(e.Callbacks={},e.pagelets=[]),ua=e.events=new ia,S=e.site=new t,u=e.visitor=new pa,K=e.unread=new t,ka=e.threadPool=new w(qa),I=e.postPool=new w(ja),L=e.userPool=new w(pa);ua.on("queryDefined",function(){var b=n.short_name;if(n.theme&&sa(n.theme),B){var a=B["ds_site_"+b],b=B["ds_lang_"+b];a&&S.reset(C.parse(a));b&&p.extend(k,C.parse(b))}});oa();e.require("embed.compat",function(){function b(a){a.stopPropagation()}
function a(a){(a.ctrlKey&&13==a.which||10==a.which)&&h(this.form).trigger("submit")}function c(){var a=h(this);a.height(Math.max(54,a.next(".ds-hidden-text").text(this.value).height()+27))}function l(){if(G.authInWin){var a=this.href.match(/\/(login|bind)\/(\w+)\//i);if(a&&e.serviceNames[a[2]])return!J(a[2],this.href)}}function r(){var a,b,c,e,f,q=0,g=0;d.selection&&(b=d.selection.createRange(),b&&b.parentElement()==this&&(e=this.value.length,a=this.value.replace(/\r\n/g,"\n"),c=this.createTextRange(),
c.moveToBookmark(b.getBookmark()),f=this.createTextRange(),f.collapse(!1),-1<c.compareendpoints("starttoend",f)?q=g=e:(q=-c.movestart("character",-e),q+=a.slice(0,q).split("\n").length-1,-1<c.compareendpoints("endtoend",f)?g=e:(g=-c.moveend("character",-e),g+=a.slice(0,g).split("\n").length-1))));h(this).data("ds-range-start",q).data("ds-range-end",g)}function t(a){return="" g.touch&&a.addclass("ds-touch"),p.cssproperty("transition")||a.addclass("ds-no-transition"),g.ie6&&a.addclass("ds-ie6"),g.opacity||="" a.addclass("ds-no-opacity"),a}function="" c(a){if(!g.placeholder){var="" b="a.attr("placeholder");a.val(b).focus(function(){this.value===b&&(this.value="")}).blur(function(){""===this.value&&(this.value=b)})}return" a}function="" w(a){if("http:="" duoshuo.com"="==a.origin)switch(a.data.type){case" "login":q.href="a.data.redirectUrl}}function" j(a,b){var="" c="{weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[a]||[550,400];return" f.open(b+(-1="=b.indexOf("?")?"?":"&")+p.param({origin:Q.origin||" "http:="" "+q.host}),"_blank","width="+c[0]+" ,height="+c[1]+" ,toolbar="no,menubar=no,location=yes")}function" u(a){var="" v(b,d,f,h){var="" x="R(g["dialog-reposts"]({post:b.toJSON(),repostMessage:d,service:h})),q=x.el.find("form");return" q.submit(function(){function="" a(b){if(f&&h){var="" span.ds-highlight");="" c.html(parseint(c.html())+1)}}return="" h||q.find("[type="checkbox]:checked")[0]?(A.post("posts/repost",e.toJSON(q),a),x.close(),!1):(alert("\u8fd8\u6ca1\u6709\u9009\u53d1\u5e03\u5230\u54ea\u513f\u5462"),!1)}),q.find(".ds-actions" [type="checkbox]").change(function(){var" a="this.value;return" this.checked&&!u.data.social_uid["qqt"="=a?"qq":a]?void" u(a):void="" 0}),c(q.find("textarea")).keyup(a).keyup(c).focus(),!1}function="" w(a){var="" tmpl:function(a){return="" a.thread?'<li="" data-thread-id="'+a.thread.thread_id+'">'+h.map(a.authors,g.userAnchor).join("\u3001")+' \u5728 <a class="ds-read" href="'+a.thread.url+'#comments" target="_blank">'+v(a.thread.title||"\u65e0\u6807\u9898")+'</a> \u4e2d\u56de\u590d\u4e86\u4f60 <a class="ds-delete ds-read" title="\u77e5\u9053\u4e86" href="javascript:void(0)" target="_blank" rel="external">\u77e5\u9053\u4e86</a>':""},read:function(a){a=a.attr("data-thread-id");A.post("threads/read",{thread_id:a});K.data.comments--}},"unread-notifications":{title:"\u7cfb\u7edf\u6d88\u606f",
apiUrl:"users/unreadNotifications",tmpl:function(a){return'<li data-notification-id="'+a.notification_id+'" data-notification-type="'+a.type+'">'+a.content+' <a class="ds-delete ds-read" title="\u77e5\u9053\u4e86" href="javascript:void(0)" target="_blank" rel="external">\u77e5\u9053\u4e86</a></li>'},read:function(a){a=a.attr("data-notification-id");A.post("notifications/read",{notification_id:a});K.data.notifications--}}}[a],c=R("<h2>"+b.title+'</h2><ul class="ds-unread-list"></ul>');c.on("close",e.resetNotify);var d=c.el.find(".ds-unread-list").delegate(".ds-delete",
"click",function(){return h(this).parent().remove(),0===d.children().length&&c.close(),!1}).delegate(".ds-read","click",function(){b.read(h(this).parent())});h("#ds-notify").hide();A.get(b.apiUrl,{},function(a){c.el.find(".ds-unread-list").html(h.map(a.response,b.tmpl).join("\n"))})}function X(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function Y(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0;P.detach()},400)}function T(a,b,c){return a.find(".ds-post[data-post-id="+
b.data.post_id+"]")[0]?void 0:(a.find(".ds-post-placeholder").remove(),h(g.post({post:b.toJSON(),options:c})).hide()["asc"==c.order?"appendTo":"prependTo"](a).slideDown(function(){}))}function Z(a,b){function c(){var b=this;if(bubbleOutTimer&&P.owner==b)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);var d=h(b);da=setTimeout(function(){function c(a){a=a.response;L[N]?L[N].set(a):L[N]=new pa(a);P.owner==b&&ea.html(g.userInfo(a))}da=0;P.owner=b;X();var e=d.offset(),f=a.el.offset(),ya=d.innerWidth()/
2,h=a.el.innerHeight()-(e.top-f.top)+6,e=e.left-f.left-35+(35<ya?35:ya);try{if(d.hasclass("ds-comment-context"))ea.attr("id","ds-ctx-bubble").attr("data-post-id",d.attr("data-post-id")).html('<ul id="ds-ctx">'+g.ctxPost({post:I[d.attr("data-parent-id")].toJSON()})+'<div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);" target="_blank" rel="external">\u67e5\u770b\u5bf9\u8bdd</a></div>');else if(d.hasClass("ds-avatar")||d.hasClass("ds-user-name")){var f={},N=f.user_id=d.attr("data-user-id");if(!N)throw"no info";
ea.attr("id","ds-user-card").attr("data-user-id",N).empty();L[N]?ea.html(g.userInfo(L[N].data)):A.get("users/profile",fa(f),c)}P.css({bottom:h,left:e}).appendTo(a.innerEl)}catch(x){P.detach()}},200)}function d(){da?(clearTimeout(da),da=0):bubbleOutTimer||Y()}var e;this.delegate("a.ds-post-likes","click",function(){if(O())return R(g["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px").find("a.ds-service-link").click(l),!1;var a=h(this).parent(),b=a.hasClass("ds-post-liked"),c=h(this).html().match(/\((\d+)\)/),
c=(c?parseInt(c[1]):0)+(b?-1:1);return A.post("posts/vote",{post_id:a.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:b?0:1}),h(this).html(h(this).html().replace(/\(\d+\)/,"")+(c?"("+c+")":"")),a[b?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-post-repost","click",function(){var a=h(this).closest(".ds-post-self"),a=I[a.attr("data-post-id")];return V(a,""),!1}).delegate("a.ds-post-delete","click",function(){if(!confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f"))return!1;
var b=h(this).closest(".ds-post-self");return A.post("posts/remove",{post_id:b.attr("data-post-id")}),b.parent().fadeOut(200,function(){a.data.comments--;a.updateCounter("duoshuo");h(this).remove()}),!1}).delegate("a.ds-post-report","click",function(){if(!confirm("\u786e\u5b9a\u8981\u4e3e\u62a5\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f"))return!1;var a=h(this).closest(".ds-post-self");return A.post("posts/report",{post_id:a.attr("data-post-id")}),alert("\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"),!1}).delegate("a.ds-post-reply",
"click",function(){var c=h(this),d=c.closest(".ds-comment-actions");if(d.hasClass("ds-reply-active"))e.el.fadeOut(200,function(){h(this).detach()}),d.removeClass("ds-reply-active");else{var f=c.closest(".ds-ctx-entry, .ds-post-self");e?e.actionsBar.removeClass("ds-reply-active"):(e=new m.Replybox(a),e.render(!0).el.addClass("ds-inline-replybox").detach());e.el.find("[name=parent_id]").val(f.attr("data-post-id"));e.el.show().appendTo(c.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus();
e.actionsBar=d.addClass("ds-reply-active");1>=b.max_depth?e.postList=a.postList.el:(e.postList=f.siblings(".ds-children"),e.postList[0]||(e.postList=h('<ul class="ds-children"></ul>').insertAfter(f)))}return!1}).delegate("a.ds-weibo-comments","click",function(){function a(c){ha(c);la.append(h.map(c.response,function(a){return g.post({post:a,options:b})}).join(""))}var c=h(this).closest(".ds-post-self"),d=c.attr("data-post-id");c.data("source");if(0!=c.attr("data-root-id"))return!1;var la=c.siblings(".ds-children");
return la[0]?(la.remove(),!1):(la=h('<ul class="ds-children"></ul>').insertAfter(c),A.get("posts/listComments",fa({post_id:d}),a),!1)}).delegate("a.ds-weibo-reposts","click",function(){var b=h(this).closest(".ds-post-self"),b=I[b.attr("data-post-id")],c=b.data.source;if(!u.data.social_uid["qqt"==c?"qq":c])return void U(c);var d=b.data.root_id,e="0"!=d?I[d]:b,f="";"0"!=d&&(d=prepatePost(b.data).theAuthor,f=("weibo"==c?"//@"+d.name:"|| @"+d.qqt_account)+":"+b.data.message);return V(e,f,a,c),!1}).delegate("a.ds-expand",
"click",function(){var a=h(this).parent();return a.siblings().show(),a.remove(),!1});G.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",c).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",d)}function fa(a){var b={require:"site,visitor,nonce,lang"+(ba++?"":",unread,log,extraCss"),site_ims:ga.get("ds_site_"+n.short_name+":timestamp"),lang_ims:ga.get("ds_lang_"+n.short_name+":timestamp"),referer:d.referrer};n.stylePatch&&(b.style_patch=n.stylePatch);
for(var c in b)b[c]&&(!G.ie6||200>encodeURIComponent(b[c]).length)&&(a[c]=b[c]);return a}var h=e.jQuery,ma=h(f),aa=h(d);f.postMessage&&(f.addEventListener?f.addEventListener("message",w,!1):f.attachEvent&&f.attachEvent("onmessage",w));e.scrollTo=function(a){a=a.offset().top;(a<ma.scrolltop()||a>ma.scrollTop()+ma.height())&&h("html, body").animate({scrollTop:a-40},200,"swing")};e.toJSON=function(a){var b=/\r?\n/g,c=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
d=/^(?:select|textarea)/i;a=a.map(function(){return this.elements?h.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||d.test(this.nodeName)||c.test(this.type))}).map(function(a,c){var d=h(this).val();return null==d?null:h.isArray(d)?h.map(d,function(a){return{name:c.name,value:a.replace(b,"\r\n")}}):{name:c.name,value:d.replace(b,"\r\n")}}).toArray();var e={};return h.each(a,function(){e[this.name]=this.value}),e};e.resetNotify=function(){var a=h("#ds-notify"),
b=K.data;a[0]||(a=h('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[S.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return W(h(this).data("type")),!1}).appendTo(d.body));a.html(g.notify(b))[!b.comments&&!b.notifications||"hidden"===S.data.notify_position||h(".ds-dialog")[0]?"hide":"show"]()};K.on("reset",e.resetNotify);m.Replybox=function(a){this.embedThread=a};m.Replybox.prototype=
{render:function(b){function f(a){a.data("submitting",!0);a.find(".ds-post-button").addClass("ds-waiting").html(k.posting)[0].disabled=!0}function N(a){a.data("submitting",!1);a.find(".ds-post-button").removeClass("ds-waiting").html(k.post)[0].disabled=!1}var F=this,x=F.embedThread,q=x.options,n=function(){e.require("smilies",function(){})},p={thread:x,options:q,inline:b,params:{thread_id:x.threadId,parent_id:"",nonce:e.nonce},repostArray:[],checked:0},t;for(t in u.data.repostOptions)u.data.repostOptions[t]&&
(p.repostArray.push(t),p.checked=1);var w=F.el=h(g.replybox(p)).click(n),M=w.find("form"),y=M.find("input[type=checkbox]")[0],z=M.find("a.ds-service-icon, a.ds-service-icon-grey"),v=C(M.find("textarea")).focus(n).keyup(a).keyup(c).bind("focus mousedown mouseup keyup",r),D=w.find(".ds-add-emote").click(function(a){var b=e.smiliesTooltip;return D.toggleClass("ds-expanded").hasClass("ds-expanded")?(b||(b=e.smiliesTooltip=new m.SmiliesTooltip,b.render(),e.require("smilies",function(){b.reset("\u5fae\u535a-\u9ed8\u8ba4")})),
b.replybox=F,b.el.appendTo(d.body).css({top:F.el.offset().top+F.el.outerHeight()+4+"px",left:F.el.find(".ds-textarea-wrapper").offset().left+"px"}),h(d.body).click(E)):E(a),!1}),E=(w.find(".ds-add-image").click(function(a){var b=v[0],c=b.value;d.selection?(b.value=c.substring(0,v.data("ds-range-start"))+'<img src="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740">'+c.substring(v.data("ds-range-end"),c.length),b.value=b.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),b.focus(),b=d.selection.createRange(),
b.collapse(),b.findText("\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740"),b.select()):(b.value=c.substring(0,b.selectionStart)+'<img src="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740">'+c.substring(b.selectionEnd),c=b.value.search("\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740"),b.setSelectionRange(c,c+7),b.focus());a.preventDefault()}),F.hideSmilies=function(){D.removeClass("ds-expanded");e.smiliesTooltip.el.detach();h(d.body).unbind("click",E)}),K=function(a,b){var c=R(g["dialog-anonymous"]({services:"weixin weibo qq renren kaixin douban".split(" "),
options:q}));if(c.el.find(".ds-dialog").css("width","320px").find(".ds-icons-32 a").click(l),!q.deny_anonymous){var d=c.el.find("form");d.submit(function(){var a=d.find("input[name=author_email]").val();return!a&&!q.require_guest_email||a.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(b(e.toJSON(d)),c.close(),!1):(alert("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684email\u5730\u5740."),
!1)});d.find("input[name=author_name]")[0].focus()}};q.deny_anonymous&&v.focus(function(){if(O()){K(M,H);var a=function(b){b.stopPropagation();v.unbind("click",a)};v.click(a)}return!1});var H=function(a){f(M);A.post("posts/create",h.extend(e.toJSON(M),a),function(a){a=I[a.response.post_id]=new ja(a.response);a=T(F.postList,a,q);if("asc"==q.order==("top"==q.formPosition)&&e.scrollTo(a),x.data.comments++,x.updateCounter("duoshuo"),v.val("").trigger("keyup"),N(M),w.hasClass("ds-inline-replybox")&&(w.detach(),
F.actionsBar.removeClass("ds-reply-active")),B)try{B.removeItem("ds_draft_"+x.threadId)}catch(b){}},function(a){N(M);alert(a.errorMessage)})};M.submit(function(){if(M.data("submitting"))return!1;var a=h.trim(M[0].message.value);return""==a||!G.placeholder&&a==v.attr("placeholder")?(alert("\u60a8\u8fd8\u6ca1\u5199\u5185\u5bb9\u5462"),!1):(O()?K(M,H):H(),!1)});var L=function(a){return h(a).hasClass("ds-service-icon-grey")?null:h(a).attr("data-service")};if(z.click(function(){return h(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),
y.value=h.map(z,L).join(","),y.checked=""!=y.value,!1}),h(y).change(function(){var a=this.checked;z[a?"removeClass":"addClass"]("ds-service-icon-grey")[a?"addClass":"removeClass"]("ds-service-icon");this.value=h.map(z,L).join(",")}),!b&&B){var J="ds_draft_"+x.threadId;v.bind("focus blur keyup",function(a){a=h(a.currentTarget).val();try{B[J]=a}catch(b){}});B[J]&&v.val(B[J])}return this}};m.Dialog=ia.extend({init:function(a,b){(this.el=h("#ds-wrapper"))[0]||(this.el=t(h('<div id="ds-wrapper"></div>')));
this.options=h.extend({width:600},b);a!==y&&h(a).attr("id","ds-reset").appendTo(this.el)},open:function(){function a(b){return 27==b.which?(e.close(),!1):void 0}function c(){return e.close(),!1}var e=this;return e.el.hide().appendTo(d.body).fadeIn(200),G.ie6&&e.el.css("top",ma.scrollTop()+100),e.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return e.close(),!1}).click(b),aa.keydown(a),h(d.body).click(c),e.close=function(){aa.unbind("keydown",a);h(d.body).unbind("click",
c);e.el.fadeOut(200,function(){h(this).remove()});e.trigger("close")},e}});g.likePanel=function(a){return a.likes?'<span class="ds-highlight">'+a.likes+"</span> \u4eba\u559c\u6b22":""};m.Meta=function(a){this.embedThread=a};m.Meta.prototype={render:function(){var a=this,c=a.embedThread.model,e=a.el=h(g.meta(c.toJSON())),F=e.find(".ds-like-thread-button");return F.click(function(x){function q(){a.tooltip.detach();h(d.body).unbind("click",q)}function k(a){switch(this.className){case "ds-like-tooltip-close":q(a);
break;default:if(!f.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return}return!1}var l=F.hasClass("ds-thread-liked");if(A.post("threads/vote",{thread_id:a.embedThread.threadId,vote:l?0:1},function(b){c.set(b);a.resetLikePanel()}),F.toggleClass("ds-thread-liked"),F.find(".ds-thread-like-text").text(l?"\u559c\u6b22":"\u5df2\u559c\u6b22"),l)return a.tooltip&&q(x),!1;a.tooltip===y&&(x=g.likeTooltip({services:{qzone:"QQ\u7a7a\u95f4",
weibo:"\u65b0\u6d6a\u5fae\u535a",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",kaixin:"\u5f00\u5fc3\u7f51",douban:"\u8c46\u74e3\u7f51",baidu:"\u767e\u5ea6\u641c\u85cf"},thread_id:c.data.thread_id}),a.tooltip=h(x).click(b).delegate("a","click",k));x={};return x.left=0,x.top=e.position().top+e.outerHeight()-4+"px",a.tooltip.appendTo(a.embedThread.innerEl).css(x),h(d.body).click(q),!1}),a.resetLikePanel(),O()&&e.hide(),a},resetLikePanel:function(){this.el.find(".ds-like-panel").html(g.likePanel(this.embedThread.model.toJSON()))}};
m.PostListHead=function(a){this.embedThread=a};m.PostListHead.prototype={render:function(){var a=this.embedThread,b=a.postList,c=this.el=h(g.postListHead({thread:a.model.toJSON(),options:a.options})),d=c.find("ul.ds-comments-tabs");d.delegate(".ds-tab a","click",function(c){d.find("a.ds-current").removeClass("ds-current");b.params.page=1;c=c.currentTarget;switch(c.className){case "ds-comments-tab-duoshuo":b.params.source="duoshuo";a.replybox.el.show();break;case "ds-comments-tab-repost":b.params.source=
"repost";a.replybox.el.hide();break;case "ds-comments-tab-weibo":b.params.source="weibo";a.replybox.el.hide();break;case "ds-comments-tab-qqt":b.params.source="qqt",a.replybox.el.hide()}return h(c).addClass("ds-current"),b.refetch(),!1});var e=c.find(".ds-sort");return e.delegate("a","click",function(){return e.find("a.ds-current").removeClass("ds-current"),b.params.order=a.options.order=this.className.replace("ds-order-",""),b.params.page=1,b.refetch(),h(this).addClass("ds-current"),!1}),e.find(".ds-order-"+
b.params.order).addClass("ds-current"),this}};m.Paginator=function(a){a=a||{};var b=this.el=a.el||h('<div class="ds-paginator"></div>'),c=this.collection=a.collection;b.delegate("a","click",function(){return c.params.page=parseInt(this.innerHTML),c.refetch(),b.find(".ds-current").removeClass("ds-current"),h(this).addClass("ds-current"),!1})};m.Paginator.prototype={reset:function(a){function b(a){e.push('<a data-page="'+a+'" href="javascript:void(0);" target="_blank" rel="external">'+a+"</a>")}var c,d=this.collection.params.page||
1,e=[];if(1<d)for(b(1),c=4<d?d-2:2,2<c&&e.push('<span class="page-break">...</d)for(b(1),c=4<d?d-2:2,2<c&&e.push('<span></ma.scrolltop()||a></ya?35:ya);try{if(d.hasclass("ds-comment-context"))ea.attr("id","ds-ctx-bubble").attr("data-post-id",d.attr("data-post-id")).html('<ul></c.compareendpoints("starttoend",f)?q=g=e:(q=-c.movestart("character",-e),q+=a.slice(0,q).split("\n").length-1,-1<c.compareendpoints("endtoend",f)?g=e:(g=-c.moveend("character",-e),g+=a.slice(0,g).split("\n").length-1))));h(this).data("ds-range-start",q).data("ds-range-end",g)}function></b.max_depth&&(c.childrenarray||c.children)&&"weibo"!=c.source&&"qqt"!=c.source){a+='<ul></e.pagelets.length;d++)a=e.pagelets[d],a.threadid==b.thread_id&&a.onmessage(b);break;case></f.screen.width&&!a.ios&&!a.android&&q.origin,a}(),ca=e.selectors={".ds-thread":{type:"embedthread"},".ds-recent-comments":{type:"recentcomments"},></arguments.length;a++)arguments[a]&&p.extend(b,arguments[a]);return(b=p.param(b))?"?"+b:></e.length;f++)if(a="></span>');d>c;c++)b(c);if(e.push('<a data-page="'+d+'" href="javascript:void(0);" class="ds-current" target="_blank" rel="external">'+d+"</a>"),d<a.pages){for(c=d+1;d+4>=c&&c<a.pages;c++)b(c);c<a.pages&&e.push('<span class="page-break">...</a.pages;c++)b(c);c<a.pages&&e.push('<span></a.pages){for(c=d+1;d+4></span>');b(a.pages)}this.el.html('<div class="ds-border"></div>'+e.join(" "))[1<a.pages?"show":"hide"]()}};e.addsmilies=function(a,b){var c="e.smiliesTooltip;c&&c.el.find("ul.ds-smilies-tabs").append("<li"><a>"+a+"</a>");
e.smilies[a]=b};m.SmiliesTooltip=function(){};m.SmiliesTooltip.prototype={render:function(){var a=this,c=a.el=h(g.smiliesTooltip(va));return c.click(b).find("ul.ds-smilies-tabs").delegate("a","click",function(){a.reset(this.innerHTML)}),c.find(".ds-smilies-container").delegate("img","click",function(){var b=a.replybox,c=b.el.find("textarea"),e=c[0],f=e.value;d.selection?(e.value=f.substring(0,c.data("ds-range-start"))+this.title+f.substring(c.data("ds-range-end"),f.length),e.value=e.value.replace(k.leave_a_message,
""),e.focus(),f=d.selection.createRange(),f.moveStart("character",c.data("ds-range-start")+this.title.length),f.collapse(),f.select()):(c=e.selectionStart+this.title.length,e.value=f.substring(0,e.selectionStart)+this.title+f.substring(e.selectionEnd),e.setSelectionRange(c,c));b.hideSmilies();e.focus()}),this},reset:function(a){var b=this.el.find("ul.ds-smilies-tabs");b.find("a.ds-current").removeClass("ds-current");b.find("a").filter(function(){return this.innerHTML==a}).addClass("ds-current");var c=
"<ul>";return h.each(va[a],function(b,d){var f=0===a.indexOf("\u5fae\u535a")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+d.replace("_org","_thumb"):e.STATIC_URL+"/images/smilies/"+d;"WordPress"===a&&(b=" "+b+" ");c+='<li><img src="'+f+'" title="'+v(b)+'"></li>'}),c+="</ul>",this.el.find(".ds-smilies-container").html(c),this}};g.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',k.no_comments_yet,"</li>"].join("")};var P=h('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),
ea=P.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){var a={};a.post_id=ea.attr("data-post-id");A.get("posts/conversation",a,function(a){function c(a,b){return g.ctxPost({post:a,index:b})}D.log(h.map(a.response,c).join("\n"));b.el.find("ol");b.el.find("ol").html(h.map(a.response,c).join("\n"))});var b=R('<h2>\u67e5\u770b\u5bf9\u8bdd</h2><ol id="ds-ctx"></ol>');return b.el.find(".ds-dialog").css("width","600px"),b.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px",
"overflow-y":"auto","padding-top":"10px"}),!1}),da=bubbleOutTimer=0;P.mouseenter(X).mouseleave(Y);m.PostList=function(a){a&&(a.params&&(this.params=a.params),a.embedThread&&(this.embedThread=a.embedThread));this.el=h('<ul class="ds-comments"></ul>')};m.PostList.prototype={url:"threads/listPosts",render:function(){return Z.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(a){var b=this.embedThread.options;this.el.html(a[0]?h.map(I.getJSON(a),function(a){return g.post({post:a,
options:b})}).join(""):g.postPlaceholder())},refetch:function(){var a=this,b=h(g.indicator()).appendTo(d.body).fadeIn(200);a.el.fadeTo(200,.5);A.get(a.url,a.params,function(c){I.set(c.parentPosts||c.relatedPosts);L.set(c.users);a.reset(c.response);a.embedThread.paginator.reset(c.cursor);a.el.fadeTo(200,1);e.scrollTo(a.el);b.remove()})}};m.EmbedThread=H.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+
(na.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var a=this.el;if("\u8bf7\u5c06\u6b64\u5904\u66ff\u6362\u6210\u6587\u7ae0\u5728\u4f60\u7684\u7ad9\u70b9\u4e2d\u7684ID"===a.data("thread-key"))return alert("\u8bf7\u8bbe\u7f6e\u6b63\u786e\u7684 data-thread-key \u5c5e\u6027"),!1;a.attr("id","ds-thread").append(g.waitingImg());var b=a.width(),c=a.data("url")||!a.attr("data-thread-id")&&h("link[rel=canonical]").attr("href");c?a.data("url",Ba(c)):a.data("container-url",Q.href);b&&400>=
b&&a.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(a){function b(a){return a.substr(a.indexOf("}")+1)}var c={duoshuo:["comments",b(k.comments_multiple)||"\u8bc4\u8bba"],repost:["reposts",b(k.reposts_multiple)||"\u8f6c\u8f7d"],weibo:["weibo_reposts",b(k.weibo_reposts_multiple)||"\u65b0\u6d6a\u5fae\u535a"],qqt:["qqt_reposts",b(k.qqt_reposts_multiple)||"\u817e\u8baf\u5fae\u535a"]},d;for(d in c)if(!a||a==d){var e=this.data[c[d][0]];this.el.find(".ds-comments-tab-"+d).html(this.el.hasClass("ds-narrow")?
'<span class="ds-service-icon ds-'+d+'"></span>'+e:(e?'<span class="ds-highlight">'+e+"</span>":"0")+c[d][1])}},onError:function(a){this.el.html("\u8bc4\u8bba\u6846\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage)},onload:function(a){var b=this,c=b.threadId=a.thread.thread_id,d=a.cursor,k=b.options=a.options,q=b.innerEl=t(h('<div id="ds-reset"></div>').appendTo(b.el));b.model=new qa(b.data=a.thread);I.set(a.parentPosts||a.relatedPosts);L.set(a.users);b.el.find("#ds-waiting").remove();k.like_thread_enabled&&
(b.meta=new m.Meta(b),q.append(b.meta.render().el));k.hot_posts&&a.hotPosts&&a.hotPosts.length&&(b.hotPosts=new m.HotPosts(h('<div class="ds-rounded"></div>'),{max_depth:1,show_context:k.show_context}),b.hotPosts.thread=b,q.append(b.hotPosts.el),b.hotPosts.onload({list:I.getJSON(a.hotPosts)}));b.postListHead=new m.PostListHead(b);b.postList=new m.PostList({embedThread:b,params:{source:"duoshuo",thread_id:c,max_depth:k.max_depth,order:k.order,limit:k.limit}});b.postList.render().reset(a.response);
b.paginator=new m.Paginator({collection:b.postList});b.paginator.reset(d);c=b.replybox=new m.Replybox(b);c.postList=b.postList.el;O()?b.loginButtons=h(g.loginButtons()).delegate("a.ds-more-services","click",function(){return b.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",l):b.toolbar=h(g.toolbar()).delegate(".ds-account-control","mouseenter",function(){h(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){h(this).removeClass("ds-active")}).delegate("a.ds-bind-more",
"click",function(){return R(g["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px").find("a.ds-service-link").click(l),!1}).delegate("a.ds-unread-comments-count","click",function(){return W("unread-comments"),!1});d=['<a name="respond"></a>',b.toolbar||b.loginButtons,c.render().el];"top"==k.formPosition&&h.fn.append.apply(q,d);q.append(b.postListHead.render().el,b.postList.el,b.paginator.el);"bottom"==k.formPosition&&h.fn.append.apply(q,d);q.append(g.poweredBy(k.poweredby_text));
b.updateCounter();a.alerts&&h.each(a.alerts,function(a,c){h('<div class="ds-alert">'+c+"</div>").insertBefore(b.toolbar||loginButtons)});k.message&&c.el.find("textarea").val(k.message).focus();K.on("reset",function(){var a=K.data.comments||0;q.find("a.ds-unread-comments-count").html(a).attr("title",a?"\u4f60\u6709"+a+"\u6761\u65b0\u56de\u590d":"\u4f60\u6ca1\u6709\u65b0\u56de\u590d").css("display",a?"inline":"none")});k.mzadx_id&&(e.require("mzadxN",function(){}),h('<div id="MZADX_'+k.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(q),
__mz_rpq=f.__mz_rpq||[],__mz_rpq.push({l:[k.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}}));e.thread=b;K.data!==y&&K.trigger("reset");O()||xa.send({visit_thread_id:b.threadId})},onMessage:function(a){T(this.postList.el,new ja(a),this.options)}});m.HotPosts=H.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(a){a.options=h.extend(this.options,a.options);H.prototype.onload.call(this,a);Z.call(this.el.find("ul"),this.thread,
this.options)}});m.RecentComments=H.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(a){return{list:h.map(a.response,function(a){return(new ja(a)).toJSON()})}}});m.RecentVisitors=H.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach();
this.el.attr("id","ds-recent-visitors").append(this.waitingEl=h(g.waitingImg()))}});m.TopThreads=H.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach();this.el.attr("id","ds-top-threads").append(this.waitingEl=h(g.waitingImg()))}});m.LoginWidget=H.extend({tmpl:"loginWidget",render:function(){var a=this.el;a.attr("id","ds-login").html(g.loginWidget("weixin weibo qq renren kaixin douban".split(" ")));a.find("a").click(l);
a.find("a.ds-logout").attr("href",E.logoutUrl())}});m.ThreadCount=H.extend({onload:function(a){var b=this.el,c=b.data("count-type")||"comments";a=a.data[c];b[b.data("replace")?"replaceWith":"html"](k[c+"_"+(a?1</a.pages?"show":"hide"]()}};e.addsmilies=function(a,b){var></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>